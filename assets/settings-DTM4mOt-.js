import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as u}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";import{getFirestore as g}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";import{getAuth as p,onAuthStateChanged as d}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";const y={apiKey:"AIzaSyCtAw-A06ZJvKXfbfpNu9D8rYurdgX0sVk",authDomain:"globetalk-2508c.firebaseapp.com",projectId:"globetalk-2508c"},l=u(y);g(l);const f=p(l),c=document.getElementById("settingsForm"),h=document.getElementById("username");d(f,async e=>{if(!e){alert("You need to be signed in to view settings."),window.location.href="../pages/login.html";return}try{const t=await e.getIdToken(),o=await fetch("https://binarybandits-profileapi.onrender.com/api/profile",{headers:{Authorization:`Bearer ${t}`}});if(!o.ok)throw new Error("Failed to fetch profile");const r=await o.json();v(r,c),h.textContent=r.username||"No username"}catch(t){console.error("Error loading settings:",t)}S(c,e)});function v(e,t){!e||!t||(t.querySelector("#language").value=e.language||"",t.querySelector("#timezone").value=e.timezone||"",t.querySelector("#ageRange").value=e.ageRange||"",t.querySelector("#gender").value=e.gender||"",t.querySelector("#interests").value=e.interests||"",t.querySelector("#bio").value=e.bio||"")}function b(e){const t={},o=e.querySelector("#language").value.trim(),r=e.querySelector("#timezone").value.trim(),n=e.querySelector("#ageRange").value.trim(),i=e.querySelector("#gender").value.trim(),a=e.querySelector("#interests").value.trim(),s=e.querySelector("#bio").value.trim();return o&&(t.language=o),r&&(t.timezone=r),n&&(t.ageRange=n),i&&(t.gender=i),a&&(t.interests=a),s&&(t.bio=s),t}function S(e,t){e.addEventListener("submit",async o=>{o.preventDefault();const r=b(e);if(Object.keys(r).length===0){alert("Please fill at least one field to update your profile.");return}try{const n=await t.getIdToken();if(!(await fetch("https://binarybandits-profileapi.onrender.com/api/profile",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(r)})).ok)throw new Error("Failed to save profile");alert("✅ Changes saved successfully!")}catch(n){console.error("Error saving settings:",n),alert("❌ Failed to save changes.")}})}
